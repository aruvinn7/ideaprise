{% extends "base/base.html" %}

{% block content %}
<!-- Hero Section -->
<div class="hero" style="background: linear-gradient(to right, #023E8A, #00B4D8); padding: 2rem 0; color: white; margin-bottom: 3rem;">
  <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
    <h1 style="color: white; margin: 0; font-size: 2.5rem;">Kegiatan</h1>    
  </div>    
</div>

<!-- Konten -->
<div style="background-color: white; padding: 3rem 0;">
  <div class="container" style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">

    {% if request.user.is_authenticated %}
    <!-- Tabel Admin -->
    <div class="card" style="background: white; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); overflow: hidden;">
      <table style="width: 100%; border-collapse: collapse;">
        <thead style="background-color: #023E8A; color: white;">
          <tr>
            <th style="padding: 15px; text-align: center;">No</th>
            <th style="padding: 15px; text-align: center;">ID Kegiatan</th>
            <th style="padding: 15px; text-align: center;">Kategori</th>
            <th style="padding: 15px; text-align: center;">Nama</th>
            <th style="padding: 15px; text-align: center;">Gambar</th>
            <th style="padding: 15px; text-align: center;">Total Gambar</th>
            <th style="padding: 15px; text-align: center;">Aksi</th>
          </tr>
        </thead>
        <tbody>
          {% for i in kegiatanobj %}
          <tr style="border-bottom: 1px solid #ADE8F4;">
            <td style="padding: 15px; color: #023E8A; text-align: center;">{{ forloop.counter }}</td>
            <td style="padding: 15px; color: #023E8A; text-align: center;">{{ i.id_kegiatan }}</td>
            <td style="padding: 15px; color: #023E8A; text-align: center;">{{ i.id_kategori.nama_kategori }}</td>
            <td style="padding: 15px; color: #023E8A; text-align: center;">{{ i.nama_kegiatan }}</td>
            <td style="padding: 15px; text-align: center;">
              {% if i.gambar_kegiatan %}
              <div style="position: relative; display: inline-block;">
                <img src="{{ i.gambar_kegiatan.url }}" alt="Gambar" width="80" style="border-radius: 4px;">
                {% if i.gambar_tambahan.count > 0 %}
                <span style="position: absolute; top: -5px; right: -5px; background: #E63946; color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 10px; display: flex; align-items: center; justify-content: center;">+{{ i.gambar_tambahan.count }}</span>
                {% endif %}
              </div>
              {% else %}
              <span style="color: gray;">-</span>
              {% endif %}
            </td>
            <td style="padding: 15px; text-align: center; color: #023E8A;">
              <strong>{{ i.gambar_tambahan.count|add:1 }}</strong>
            </td>
            <td style="padding: 15px; text-align: center;">
              <a href="{% url 'read_detailkegiatan' i.id_kegiatan %}" 
                style="background-color: #48CAE4; color: white; padding: 8px 12px; border-radius: 4px; text-decoration: none; font-size: 0.85rem; margin-right: 4px;">
                View
              </a>
              <a href="{% url 'update_kegiatan' i.id_kegiatan %}" 
                style="background-color: #0096C7; color: white; padding: 8px 12px; border-radius: 4px; text-decoration: none; font-size: 0.85rem; margin-right: 4px;">
                Update
              </a>
              <a href="{% url 'delete_kegiatan' i.id_kegiatan %}" 
                style="background-color: #E63946; color: white; padding: 8px 12px; border-radius: 4px; text-decoration: none; font-size: 0.85rem;"
                onclick="return confirm('Yakin ingin menghapus kegiatan ini beserta semua gambarnya?')">
                Delete
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% else %}
    <!-- Tampilan User (Card Layout) -->
    <div class="row">
      {% for i in kegiatanobj %}
      <div class="col-md-6 col-lg-4 mb-5 d-flex align-items-stretch">
        <div class="card shadow-sm w-100" style="border-radius: 15px; overflow: hidden; position: relative;">
          {% if i.gambar_kegiatan %}
          <div style="position: relative;">
            <img src="{{ i.gambar_kegiatan.url }}" class="card-img-top" alt="{{ i.nama_kegiatan }}" style="height: 250px; object-fit: cover;">
            
            <!-- Badge untuk multiple images -->
            {% if i.gambar_tambahan.count > 0 %}
            <div style="position: absolute; top: 10px; right: 10px; background: rgba(2, 62, 138, 0.9); color: white; padding: 5px 10px; border-radius: 20px; font-size: 12px; display: flex; align-items: center; gap: 5px;">
              <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                <path d="M6.002 5.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"/>
                <path d="M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13zm13 1a.5.5 0 0 1 .5.5v6l-3.775-1.947a.5.5 0 0 0-.577.093l-3.71 3.71-2.66-1.772a.5.5 0 0 0-.63.062L1.002 12v.54A1.5 1.5 0 0 1 1.5 3h13z"/>
              </svg>
              {{ i.gambar_tambahan.count|add:1 }}
            </div>
            {% endif %}
            
            <!-- Overlay gradient -->
            <div style="position: absolute; bottom: 0; left: 0; right: 0; height: 60px; background: linear-gradient(transparent, rgba(0,0,0,0.7));"></div>
          </div>
          {% endif %}
          
          <div class="card-body d-flex flex-column">
            <h5 class="card-title" style="color: #023E8A; font-weight: bold;">{{ i.nama_kegiatan }}</h5>
            <p class="card-text" style="flex-grow: 1; color: #555;">{{ i.deskripsi_kegiatan|truncatewords:20 }}</p>
            
            <div class="mt-auto">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <small class="text-muted">{{ i.id_kategori.nama_kategori }}</small>
                {% if i.gambar_tambahan.count > 0 %}
                <small class="text-primary" style="font-weight: 500;">
                  ðŸ“¸ {{ i.gambar_tambahan.count|add:1 }} Foto
                </small>
                {% endif %}
              </div>
              <a href="{% url 'read_detailkegiatan' i.id_kegiatan %}" class="btn btn-primary w-100" style="background: linear-gradient(45deg, #023E8A, #0077B6); border: none; padding: 10px;">
                {% if i.gambar_tambahan.count > 0 %}
                Lihat Galeri
                {% else %}
                Lihat Detail
                {% endif %}
              </a>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    {% if request.user.is_authenticated %}
    <div class="text-center mt-4">
      <a href="{% url 'create_kegiatan' %}" class="btn btn-primary btn-lg" style="background: linear-gradient(45deg, #023E8A, #0077B6); border: none; padding: 12px 30px;">
        + Tambah Kegiatan Baru
      </a>
    </div>
    {% endif %}
  </div>
</div>
{% endblock %}